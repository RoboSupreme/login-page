<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Music Journal</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      height: 100%;
      overflow-y: auto;
    }
    
    .journal-container {
      position: relative;
      min-height: 100vh;
      width: 100%;
      background-image: url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      padding-bottom: 50px;
      overflow-y: visible;
    }
    
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 1;
    }
    
    .journal-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
    }
    
    .header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 30px;
      border-bottom: 2px solid #2196F3;
    }
    
    .header h1 {
      color: #2196F3;
      margin-bottom: 10px;
    }
    
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      position: relative;
    }
    
    .back-btn {
      background-color: #555;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .add-entry-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .timeline {
      position: relative;
      max-width: 700px;
      margin: 0 auto;
    }
    
    .timeline::after {
      content: '';
      position: absolute;
      width: 6px;
      background-color: #2196F3;
      top: 0;
      bottom: 0;
      left: 50%;
      margin-left: -3px;
    }
    
    .entry {
      position: relative;
      width: 46%;
      margin-bottom: 40px;
    }
    
    .entry:nth-child(odd) {
      left: 0;
    }
    
    .entry:nth-child(even) {
      left: 54%;
    }
    
    .entry-content {
      padding: 20px;
      background-color: white;
      border-radius: 6px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    .entry-date {
      position: absolute;
      top: 10px;
      font-size: 14px;
      color: #777;
      font-weight: bold;
    }
    
    .entry:nth-child(odd) .entry-date {
      right: 10px;
    }
    
    .entry:nth-child(even) .entry-date {
      left: 10px;
    }
    
    .entry-title {
      margin-top: 30px;
      margin-bottom: 10px;
      color: #333;
    }
    
    .entry-icon {
      position: absolute;
      background-color: white;
      border: 4px solid #2196F3;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 15px;
      z-index: 1;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .entry-icon:hover {
      transform: scale(1.1);
    }
    
    .entry:nth-child(odd) .entry-icon {
      right: -63px;
    }
    
    .entry:nth-child(even) .entry-icon {
      left: -63px;
    }
    
    .entry-type-video i {
      color: #dc3545;
    }
    
    .entry-type-document i {
      color: #0d6efd;
    }
    
    .no-entries {
      text-align: center;
      padding: 40px 0;
      color: #777;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      width: 60%;
      max-width: 500px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover {
      color: black;
    }
    
    .modal h2 {
      margin-top: 0;
      color: #2196F3;
    }
    
    .form-group {
      margin-bottom: 15px;
      display: block;
      width: 100%;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      display: block;
    }
    
    .form-group button {
      padding: 10px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: block;
      width: 100%;
    }
    
    /* Media queries for responsiveness */
    @media screen and (max-width: 767px) {
      .timeline::after {
        left: 31px;
      }
      
      .entry {
        width: 85%;
        left: 65px !important;
      }
      
      .entry:nth-child(odd) .entry-icon,
      .entry:nth-child(even) .entry-icon {
        left: -50px;
      }
      
      .entry:nth-child(odd) .entry-date,
      .entry:nth-child(even) .entry-date {
        right: 10px;
        left: auto;
      }
    }
    
    /* Add a floating "back to top" button for when many entries exist */
    .back-to-top {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 99;
    }
    
    .back-to-top:hover {
      background-color: #0b7dda;
    }
  </style>
</head>
<body>
  <div class="journal-container">
    <div class="overlay"></div>
    <div class="journal-content">
      <div class="header">
        <h1>Music Journal</h1>
        <p id="studentName">Student: </p>
      </div>
      
      <div class="nav-buttons">
        <button id="backBtn" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
        <button id="addEntryBtn" class="add-entry-btn"><i class="fas fa-plus"></i> Add New Entry</button>
      </div>
      
      <div class="timeline" id="entriesTimeline">
        <!-- Journal entries will be dynamically added here -->
        <div class="no-entries" id="noEntriesMsg">
          <p>No journal entries yet. Click "Add New Entry" to get started.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Back to top button -->
  <button id="backToTopBtn" class="back-to-top"><i class="fas fa-arrow-up"></i></button>
  
  <!-- Add Entry Modal -->
  <div id="addEntryModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" id="modalClose">&times;</span>
      <h2>Add New Journal Entry</h2>
      <form id="entryForm" style="display: block; width: 100%;">
        <div class="form-group">
          <label for="entryTitle">Title</label>
          <input type="text" id="entryTitle" required>
        </div>
        <div class="form-group">
          <label for="entryType">Entry Type</label>
          <select id="entryType" required>
            <option value="">Select entry type</option>
            <option value="video">Video</option>
            <option value="document">Document</option>
          </select>
        </div>
        <div class="form-group">
          <label for="entryLink">Microsoft Link</label>
          <input type="url" id="entryLink" required placeholder="https://...">
        </div>
        <div class="form-group">
          <button type="submit">Save Entry</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    // Immediately executing function to avoid global scope pollution
    (function() {
      console.log("Script executing");
      
      // Wait for DOM to be fully loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
      } else {
        initialize();
      }
      
      // Main initialization function
      function initialize() {
        console.log("Initializing page");
        
        // Check login status first
        if (localStorage.getItem('musicUserLoggedIn') !== 'true') {
          console.log("Not logged in, redirecting");
          window.location.href = 'index.html';
          return;
        }
        
        // User is logged in, continue
        const username = localStorage.getItem('musicUsername');
        console.log("Logged in as:", username);
        
        // Update the header
        document.querySelector('.header h1').textContent = `${username}'s Music Journal`;
        document.getElementById('studentName').textContent = `Student: ${username}`;
        
        // Get user data for entries
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const userEmail = currentUser.email || username + '@example.com';
        
        // Load existing entries
        loadEntries(userEmail);
        
        // Explicit button handlers - USING DIRECT DOM LEVEL 0 EVENTS
        // Back to Home button
        const backBtn = document.getElementById('backBtn');
        backBtn.onclick = function() {
          console.log("Back button clicked");
          // Log out the user
          localStorage.removeItem('musicUserLoggedIn');
          localStorage.removeItem('musicUsername');
          localStorage.removeItem('currentUser');
          window.location.href = 'index.html';
        };
        
        // Add Entry button
        const addEntryBtn = document.getElementById('addEntryBtn');
        addEntryBtn.onclick = function() {
          console.log("Add Entry button clicked");
          document.getElementById('addEntryModal').style.display = 'block';
        };
        
        // Modal close button
        const closeBtn = document.querySelector('.close');
        closeBtn.onclick = function() {
          console.log("Close button clicked");
          document.getElementById('addEntryModal').style.display = 'none';
        };
        
        // Close modal when clicking outside
        window.onclick = function(event) {
          if (event.target === document.getElementById('addEntryModal')) {
            document.getElementById('addEntryModal').style.display = 'none';
          }
        };
        
        // Back to top button
        const backToTopBtn = document.getElementById('backToTopBtn');
        backToTopBtn.onclick = function() {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        };
        
        // Show/hide back to top button on scroll
        window.onscroll = function() {
          if (window.pageYOffset > 300) {
            backToTopBtn.style.display = 'block';
          } else {
            backToTopBtn.style.display = 'none';
          }
        };
        
        // Form submission
        const entryForm = document.getElementById('entryForm');
        entryForm.onsubmit = function(e) {
          e.preventDefault();
          console.log("Form submitted");
          
          const title = document.getElementById('entryTitle').value;
          const type = document.getElementById('entryType').value;
          const link = document.getElementById('entryLink').value;
          
          if (!title || !type || !link) {
            alert('Please fill in all fields');
            return;
          }
          
          const newEntry = {
            id: Date.now().toString(),
            title,
            type,
            link,
            date: new Date().toISOString()
          };
          
          // Add entry to localStorage
          const entriesKey = `journal_entries_${userEmail}`;
          const entries = JSON.parse(localStorage.getItem(entriesKey) || '[]');
          entries.unshift(newEntry);
          localStorage.setItem(entriesKey, JSON.stringify(entries));
          
          // Close modal and reset form
          document.getElementById('addEntryModal').style.display = 'none';
          entryForm.reset();
          
          // Reload entries
          loadEntries(userEmail);
        };
      }
      
      // Function to load journal entries
      function loadEntries(userEmail) {
        const entriesContainer = document.getElementById('entriesTimeline');
        const noEntriesMsg = document.getElementById('noEntriesMsg');
        
        // Get entries from localStorage
        const entriesKey = `journal_entries_${userEmail}`;
        const entries = JSON.parse(localStorage.getItem(entriesKey) || '[]');
        
        if (entries.length === 0) {
          noEntriesMsg.style.display = 'block';
          document.getElementById('backToTopBtn').style.display = 'none';
        } else {
          noEntriesMsg.style.display = 'none';
          
          // Clear existing entries
          const children = Array.from(entriesContainer.children);
          children.forEach(child => {
            if (child !== noEntriesMsg) {
              entriesContainer.removeChild(child);
            }
          });
          
          // Add entries to timeline
          entries.forEach((entry, index) => {
            const entryElement = createEntryElement(entry);
            entryElement.classList.add(index % 2 === 0 ? 'left' : 'right');
            entriesContainer.insertBefore(entryElement, noEntriesMsg);
          });
        }
      }
      
      // Function to create entry element
      function createEntryElement(entry) {
        const container = document.createElement('div');
        container.className = 'container';
        
        const content = document.createElement('div');
        content.className = 'content';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'entry-title';
        
        const icon = document.createElement('div');
        icon.className = `entry-icon ${entry.type}-icon`;
        
        const iconElement = document.createElement('i');
        if (entry.type === 'video') {
          iconElement.className = 'fas fa-video';
        } else {
          iconElement.className = 'fas fa-file-alt';
        }
        
        icon.appendChild(iconElement);
        
        const title = document.createElement('h2');
        title.textContent = entry.title;
        
        titleDiv.appendChild(icon);
        titleDiv.appendChild(title);
        
        const date = document.createElement('p');
        date.className = 'entry-date';
        date.textContent = new Date(entry.date).toLocaleString();
        
        const link = document.createElement('a');
        link.href = entry.link;
        link.className = 'entry-link';
        link.textContent = 'View in Microsoft';
        link.target = '_blank';
        
        content.appendChild(titleDiv);
        content.appendChild(date);
        content.appendChild(link);
        container.appendChild(content);
        
        return container;
      }
    })();
  </script>
</body>
</html>
